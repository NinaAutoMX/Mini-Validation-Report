<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mini Validation Report</title>
  <link rel="icon" type="image/png" href="https://copilot.microsoft.com/th/id/BCO.5f34131a-d4f6-472e-94d0-cdd1c38d89f0.png">
  <style>
    :root {
      --bg-primary: #ffffff; --bg-secondary: #f8f9fa; --bg-section: rgba(255,255,255,0.95);
      --text-primary: #1a1a1a; --text-secondary: #4e125f; --border-color: #e0e0e0;
      --shadow: rgba(0,0,0,0.1); --accent: #6a1a7f; --accent-hover: #4e125f;
      --input-bg: rgba(255,255,255,0.9); --success: #27ae60; --warning: #e67e22; --danger: #c0392b;
    }
    [data-theme="dark"] {
      --bg-primary: #1a1a1a; --bg-secondary: #2c2c2c; --bg-section: rgba(40,40,40,0.95);
      --text-primary: #e0e0e0; --text-secondary: #b896d4; --border-color: #404040;
      --shadow: rgba(0,0,0,0.3); --accent: #8e5ea2; --accent-hover: #b896d4; --input-bg: rgba(50,50,50,0.9);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Calibri (Body)', -apple-system, BlinkMacSystemFont, Roboto, Calibri (Body), sans-serif;
      color: var(--text-primary);
      background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 50%, #7c3aed 100%);
      min-height: 100vh; padding: 20px; transition: all 0.3s ease;
    }
    .container {
      max-width: 1400px; margin: 0 auto; background: var(--bg-primary);
      border-radius: 16px; box-shadow: 0 20px 60px var(--shadow); overflow: hidden;
    }
    .header {
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-hover) 100%);
      padding: 30px 40px; display: flex; justify-content: space-between;
      align-items: center; color: white; gap: 14px; flex-wrap: wrap;
    }
    .header-content { display: flex; align-items: center; gap: 30px; flex: 1; }
    .header h1 { font-size: 2em; font-weight: 600; margin: 0; white-space: nowrap; }
    .autobody-input-wrapper { flex: 1; max-width: 400px; }
    .autobody-input-wrapper label { display: block; font-size: 0.85em; margin-bottom: 8px; opacity: 0.9; }
    .autobody-input-wrapper input {
      width: 100%; padding: 10px 14px; border: 2px solid rgba(255,255,255,0.3);
      border-radius: 8px; background: rgba(255,255,255,0.15); color: white;
      font-size: 1em; transition: all 0.3s ease;
    }
    .autobody-input-wrapper input::placeholder { color: rgba(255,255,255,0.6); }
    .autobody-input-wrapper input:focus { outline: none; background: rgba(255,255,255,0.25); border-color: rgba(255,255,255,0.6); }
    .header-buttons { display: flex; gap: 10px; flex-wrap: wrap; }
    .theme-toggle {
      background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50px; padding: 8px 16px; cursor: pointer;
      display: flex; align-items: center; gap: 8px; transition: all 0.3s ease;
      color: white; font-size: 0.9em;
    }
    .theme-toggle:hover { background: rgba(255,255,255,0.3); transform: translateY(-2px); }
    .content { padding: 40px; }
    .section {
      background: var(--bg-section); padding: 30px; border-radius: 12px;
      margin-bottom: 30px; border: 1px solid var(--border-color);
      box-shadow: 0 2px 8px var(--shadow); transition: all 0.3s ease;
    }
    .section:hover { box-shadow: 0 4px 16px var(--shadow); }
    .section-title {
      font-size: 1.3em; font-weight: 600; color: var(--text-secondary);
      margin-bottom: 25px; padding-bottom: 14px; border-bottom: 2px solid var(--accent);
      display: flex; align-items: center; gap: 10px;
    }
    .section-title::before { content: "‚óè"; color: var(--accent); }
    .input-grid { display: grid; gap: 20px; }
    .input-group { display: grid; grid-template-columns: 200px 1fr; gap: 14px; align-items: center; }
    .input-pair { display: grid; grid-template-columns: 180px 1fr 180px 1fr; gap: 14px; align-items: center; }
    label { font-weight: 500; color: var(--text-primary); font-size: 0.95em; }
    input[type="number"], input[type="text"], input[type="date"], textarea {
      padding: 12px 16px; font-size: 14px; border: 2px solid var(--border-color);
      border-radius: 8px; background: var(--input-bg); color: var(--text-primary);
      transition: all 0.3s ease; font-family: inherit;
    }
    input:hover, textarea:hover { border-color: var(--accent); }
    input:focus, textarea:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(106,26,127,0.1); }
    textarea { min-height: 100px; resize: vertical; }
    .disclaimer-select {
      width: 100%; padding: 12px 16px; font-size: 14px; border: 2px solid var(--border-color);
      border-radius: 8px; background: var(--input-bg); color: var(--text-primary);
      transition: all 0.3s ease; font-family: inherit; cursor: pointer;
    }
    .disclaimer-select:hover { border-color: var(--accent); }
    .disclaimer-select:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(106,26,127,0.1); }
    .checkbox-group { display: flex; flex-wrap: wrap; gap: 12px 20px; align-items: center; }
    .checkbox-group label { display: flex; align-items: center; cursor: pointer; user-select: none; }
    .checkbox-group input[type="checkbox"], .checkbox-group input[type="radio"] {
      margin-right: 8px; width: 18px; height: 18px; cursor: pointer; accent-color: var(--accent);
    }
    .disclaimer-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
    fieldset { border: 2px solid var(--border-color); border-radius: 10px; padding: 14px 20px; background: var(--bg-secondary); transition: all 0.3s ease; }
    fieldset:hover { border-color: var(--accent); }
    legend { font-weight: 600; color: var(--accent); padding: 0 10px; font-size: 0.95em; }
    .button-container { display: flex; gap: 20px; justify-content: center; margin: 40px 0 20px; flex-wrap: wrap; }
    button {
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-hover) 100%);
      color: white; border: none; border-radius: 10px; padding: 14px 32px;
      font-size: 1em; font-weight: 600; cursor: pointer; transition: all 0.3s ease;
      box-shadow: 0 4px 12px var(--shadow);
    }
    button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px var(--shadow); }
    button:active { transform: translateY(0); }
    .new-report-btn { background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); }
    .autosave-indicator {
      text-align: center; color: var(--accent); font-size: 0.9em; font-style: italic;
      padding: 14px; background: var(--bg-section); border-radius: 8px;
      margin-top: 10px; border: 1px solid var(--border-color);
    }
    #output {
      background: var(--bg-section); border: 2px solid var(--accent);
      border-left: 6px solid var(--accent); padding: 30px; font-size: 14px;
      line-height: 1.8; margin-top: 30px; border-radius: 12px; box-shadow: 0 4px 16px var(--shadow);
    }
    #reportText { word-break: break-word; font-family: 'Calibri Body', Calibri, sans-serif; font-size: 11pt; }
    /* Stellantis radio sub-group */
    .stellantis-radio-group {
      display: flex; gap: 16px; align-items: center; margin-top: 6px;
      padding: 8px 14px; background: var(--bg-secondary);
      border: 1px solid var(--border-color); border-radius: 8px;
      flex-wrap: wrap;
    }
    .stellantis-radio-group label { font-weight: 400; font-size: 0.92em; }
    @media (max-width: 768px) {
      .header { flex-direction: column; }
      .header-content { flex-direction: column; width: 100%; }
      .autobody-input-wrapper { max-width: 100%; }
      .input-pair, .input-group { grid-template-columns: 1fr; }
      .content { padding: 20px; }
      .section { padding: 20px; }
      .button-container { flex-direction: column; }
      button { width: 100%; }
    }
    .fade-in { animation: fadeIn 0.5s ease-in; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body>
<div class="container fade-in">

  <!-- HEADER -->
  <div class="header">
    <div class="header-content">
      <h1>Validation Report</h1>
      <div class="autobody-input-wrapper">
        <label for="autobodyName">Autobody Name</label>
        <input type="text" id="autobodyName" placeholder="Enter autobody name...">
      </div>
    </div>
    <div class="header-buttons">
      <button class="theme-toggle" onclick="toggleTheme()">
        <span id="themeIcon">üåô</span><span id="themeText">Dark Mode</span>
      </button>
      <button class="theme-toggle" onclick="getMotivation()">
        <span>üí™</span><span>I need Motivation</span>
      </button>
    </div>
  </div>

  <!-- MOTIVATION BOX -->
  <div id="motivationBox" style="display:none; margin:20px 40px; padding:25px; background:linear-gradient(135deg,rgba(255,215,0,0.2),rgba(255,140,0,0.2)); border-left:5px solid #ffa500; border-radius:12px;">
    <p id="motivationText" style="font-size:1.1em; font-style:italic; margin:0; color:var(--text-primary);"></p>
    <button onclick="document.getElementById('motivationBox').style.display='none'" style="margin-top:14px; padding:8px 20px; font-size:0.9em;">Close</button>
  </div>

  <!-- MAIN CONTENT -->
  <div class="content">

    <!-- Section: Management System -->
    <div class="section">
      <h3 class="section-title">Management System</h3>
      <div class="input-grid">
        <div class="checkbox-group">
          <label><input type="checkbox" id="chkTms"> TMS</label>
          <label><input type="checkbox" id="chkDrSmash"> Dr Smash</label>
          <label><input type="checkbox" id="chkVantage"> Vantage</label>
          <label><input type="checkbox" id="chkVeculim"> Veculim</label>
          <label><input type="checkbox" id="chkEasyCost"> Easy Costings</label>
          <label><input type="checkbox" id="chkPlanMan"> Plan Manager</label>
          <label><input type="checkbox" id="chkAis"> AIS</label>
          <label><input type="checkbox" id="chkMultiCat"> MultiCat</label>
          <label><input type="checkbox" id="chkQsa"> QSA</label>
          <label><input type="checkbox" id="chkWorkshopBoss"> Workshop Boss</label>
          <label><input type="checkbox" id="chkAutoSoft"> Auto Soft</label>
        </div>
        <div class="input-group">
          <label for="otherMan">Other:</label>
          <input type="text" id="otherMan" placeholder="Other management system...">
        </div>
      </div>
    </div>

    <!-- Section: Approvals -->
    <div class="section">
      <h3 class="section-title">Approvals</h3>
      <div class="checkbox-group">
        <label><input type="checkbox" id="chkBaic"> BAIC</label>
        <label><input type="checkbox" id="chkBYD"> BYD</label>
        <label><input type="checkbox" id="chkChery"> Chery</label>
        <label><input type="checkbox" id="chkFord"> Ford</label>
        <label><input type="checkbox" id="chkGWMhaval"> GWM/Haval</label>
        <label><input type="checkbox" id="chkHonda"> Honda</label>
        <label><input type="checkbox" id="chkHyundai"> Hyundai</label>
        <label><input type="checkbox" id="chkIsuzu"> Isuzu</label>
        <label><input type="checkbox" id="chkJAC"> JAC</label>
        <label><input type="checkbox" id="chkJetour"> Jetour</label>
        <label><input type="checkbox" id="chkLDV"> LDV</label>
        <label><input type="checkbox" id="chkMahindra"> Mahindra</label>
        <label><input type="checkbox" id="chkMG"> MG</label>
        <label><input type="checkbox" id="chkMitsubishi"> Mitsubishi</label>
        <label><input type="checkbox" id="chkNissan"> Nissan</label>
        <label><input type="checkbox" id="chkRenault"> Renault</label>
        <!-- Stellantis with Premium/Standard radio -->
        <label><input type="checkbox" id="chkStellantis" onchange="toggleStellantisRadio()"> Stellantis</label>
        <label><input type="checkbox" id="chkSubaru"> Subaru</label>
        <label><input type="checkbox" id="chkSuzuki"> Suzuki</label>
        <label><input type="checkbox" id="chkTata"> Tata</label>
        <label><input type="checkbox" id="chkVolvo"> Volvo</label>
        <label><input type="checkbox" id="chkBmw"> BMW</label>
      </div>
      <!-- Stellantis Premium/Standard radio (hidden until Stellantis is checked) -->
      <div id="stellantisRadioGroup" class="stellantis-radio-group" style="display:none; margin-top:14px;">
        <span style="font-weight:600; color:var(--accent);">Stellantis type:</span>
        <label><input type="radio" name="stellantisType" id="stellantisPremium" value="Premium"> Premium</label>
        <label><input type="radio" name="stellantisType" id="stellantisStandard" value="Standard"> Standard</label>
      </div>
    </div>

    <!-- Section: Repair Totals -->
    <div class="section">
      <h3 class="section-title">Repair Totals</h3>
      <div class="input-grid">
        <div class="checkbox-group" style="margin-bottom:10px;">
          <label><input type="checkbox" id="chkLastSubmitted"> Data last submitted:</label>
          <input type="date" id="lastSubmittedDate" style="max-width:200px;">
          <label><input type="checkbox" id="chkHasAccess"> Does not have website access</label>
        </div>
        <div class="input-pair">
          <label for="activeRepairs">Active Repairs:</label>
          <input type="number" id="activeRepairs">
          <label for="completed2026">Completed 2026:</label>
          <input type="number" id="completed2026">
        </div>
        <div class="input-pair">
          <label for="completed2025">Completed 2025:</label>
          <input type="number" id="completed2025">
          <label for="completed2024">Completed 2024:</label>
          <input type="number" id="completed2024">
        </div>
        <div class="input-pair">
          <label for="completed2023">Completed 2023:</label>
          <input type="number" id="completed2023">
          <label for="completed2022">Completed 2022:</label>
          <input type="number" id="completed2022">
        </div>
        <div class="input-pair">
          <label for="writeOffs">Write-offs (total):</label>
          <input type="number" id="writeOffs">
          <label for="invalidJobs">Invalid Jobs:</label>
          <input type="number" id="invalidJobs">
        </div>
        <div class="input-pair">
          <label for="pp2026">PP 2026:</label>
          <input type="number" id="pp2026">
          <label for="pp2025">PP 2025:</label>
          <input type="number" id="pp2025">
        </div>
        <div class="input-pair">
          <label for="2026tsp">2026 TSP (R):</label>
          <input type="number" id="2026tsp">
          <label for="2025tsp">2025 TSP (R):</label>
          <input type="number" id="2025tsp">
        </div>
        <div class="input-group">
          <label for="openLong">Open &gt;100 Days:</label>
          <input type="number" id="openLong" placeholder="e.g. 186">
        </div>
      </div>
    </div>

    <!-- Section: Aggregate Data -->
    <div class="section">
      <h3 class="section-title">Aggregate Data Submission</h3>
      <div class="input-grid">
        <div class="checkbox-group">
          <label><input type="checkbox" id="chkAggregateMake"> Submitting aggregate data</label>
          <label><input type="radio" name="aggregateMakeOption" value="Including"> Including</label>
          <label><input type="radio" name="aggregateMakeOption" value="Excluding"> Excluding</label>
          <label><input type="checkbox" id="chkFullData"> Submitting full data for all brands</label>
          <label><input type="checkbox" id="chkFullBrandData"> Submitting full data for approved brands</label>
          <label><input type="checkbox" id="chkInsurerName"> Not submitting Insurer Name</label>
        </div>
        <div class="input-group">
          <label><input type="checkbox" id="chkAggregateText"> Receiving aggregate data for some repairs</label>
          <input type="text" id="aggregateTextBrands" placeholder="e.g. Ford, Hyundai, Mahindra">
        </div>
        <div class="input-group">
          <label><input type="checkbox" id="chkNotReceiving"> Not submitting full data for:</label>
          <input type="text" id="receivingNotBrands" placeholder="e.g. Ford, Hyundai, Mahindra">
        </div>
      </div>
    </div>

    <!-- Section: Disclaimer Forms -->
    <div class="section">
      <h3 class="section-title">Disclaimer Forms</h3>
      <div class="disclaimer-grid">
        <fieldset><legend>BAIC</legend>
          <select id="baicDisclaimer" class="disclaimer-select">
            <option value="">Select status...</option>
            <option value="not-submitting">Not submitting</option>
            <option value="submitting">Submitting</option>
            <option value="partial">Partial submission</option>
          </select>
        </fieldset>
        <fieldset><legend>Ford 08/11/2024</legend>
          <select id="fordDisclaimer" class="disclaimer-select">
            <option value="">Select status...</option>
            <option value="not-submitting">Not submitting</option>
            <option value="submitting">Submitting</option>
            <option value="partial">Partial submission</option>
          </select>
        </fieldset>
        <fieldset><legend>GWM &amp; Haval 19/08/2025</legend>
          <select id="gwmhavalDisclaimer" class="disclaimer-select">
            <option value="">Select status...</option>
            <option value="not-submitting">Not submitting</option>
            <option value="submitting">Submitting</option>
            <option value="partial">Partial submission</option>
          </select>
        </fieldset>
        <fieldset><legend>Honda 17/01/2025</legend>
          <select id="hondaDisclaimer" class="disclaimer-select">
            <option value="">Select status...</option>
            <option value="not-submitting">Not submitting</option>
            <option value="submitting">Submitting</option>
            <option value="partial">Partial submission</option>
          </select>
        </fieldset>
        <fieldset><legend>Hyundai 01/04/2025</legend>
          <select id="hyundaiDisclaimer" class="disclaimer-select">
            <option value="">Select status...</option>
            <option value="not-submitting">Not submitting</option>
            <option value="submitting">Submitting</option>
            <option value="partial">Partial submission</option>
          </select>
        </fieldset>
        <fieldset><legend>Isuzu 21/05/2025</legend>
          <select id="isuzuDisclaimer" class="disclaimer-select">
            <option value="">Select status...</option>
            <option value="not-submitting">Not submitting</option>
            <option value="submitting">Submitting</option>
            <option value="partial">Partial submission</option>
          </select>
        </fieldset>
        <fieldset><legend>JAC 27/06/2025</legend>
          <select id="jacDisclaimer" class="disclaimer-select">
            <option value="">Select status...</option>
            <option value="not-submitting">Not submitting</option>
            <option value="submitting">Submitting</option>
            <option value="partial">Partial submission</option>
          </select>
        </fieldset>
        <fieldset><legend>LDV 19/11/2025</legend>
          <select id="ldvDisclaimer" class="disclaimer-select">
            <option value="">Select status...</option>
            <option value="not-submitting">Not submitting</option>
            <option value="submitting">Submitting</option>
            <option value="partial">Partial submission</option>
          </select>
        </fieldset>
        <fieldset><legend>Mahindra 22/07/2025</legend>
          <select id="mahindraDisclaimer" class="disclaimer-select">
            <option value="">Select status...</option>
            <option value="not-submitting">Not submitting</option>
            <option value="submitting">Submitting</option>
            <option value="partial">Partial submission</option>
          </select>
        </fieldset>
        <fieldset><legend>MG 26/11/2025</legend>
          <select id="mgDisclaimer" class="disclaimer-select">
            <option value="">Select status...</option>
            <option value="not-submitting">Not submitting</option>
            <option value="submitting">Submitting</option>
            <option value="partial">Partial submission</option>
          </select>
        </fieldset>
        <fieldset><legend>Mitsubishi 28/03/2025</legend>
          <select id="mitsubishiDisclaimer" class="disclaimer-select">
            <option value="">Select status...</option>
            <option value="not-submitting">Not submitting</option>
            <option value="submitting">Submitting</option>
            <option value="partial">Partial submission</option>
          </select>
        </fieldset>
        <fieldset><legend>Renault 02/12/2025</legend>
          <select id="renaultDisclaimer" class="disclaimer-select">
            <option value="">Select status...</option>
            <option value="not-submitting">Not submitting</option>
            <option value="submitting">Submitting</option>
            <option value="partial">Partial submission</option>
          </select>
        </fieldset>
        <fieldset><legend>Subaru 04/02/2026</legend>
          <select id="subaruDisclaimer" class="disclaimer-select">
            <option value="">Select status...</option>
            <option value="not-submitting">Not submitting</option>
            <option value="submitting">Submitting</option>
            <option value="partial">Partial submission</option>
          </select>
        </fieldset>
        <fieldset><legend>Suzuki 09/06/2025</legend>
          <select id="suzukiDisclaimer" class="disclaimer-select">
            <option value="">Select status...</option>
            <option value="not-submitting">Not submitting</option>
            <option value="submitting">Submitting</option>
            <option value="partial">Partial submission</option>
          </select>
        </fieldset>
        <fieldset><legend>Volvo 05/06/2025</legend>
          <select id="volvoDisclaimer" class="disclaimer-select">
            <option value="">Select status...</option>
            <option value="not-submitting">Not submitting</option>
            <option value="submitting">Submitting</option>
            <option value="partial">Partial submission</option>
          </select>
        </fieldset>
        <fieldset><legend>Stellantis Categorization Forms 18/11/2024</legend>
          <select id="stellantisDisclaimer" class="disclaimer-select">
            <option value="">Select status...</option>
            <option value="not-submitting">Not submitting</option>
            <option value="submitting">Submitting</option>
            <option value="partial">Partial submission</option>
          </select>
        </fieldset>
        <fieldset><legend>Volvo Warranty &amp; Maintenance 02/04/2025</legend>
          <select id="volvovDisclaimer" class="disclaimer-select">
            <option value="">Select status...</option>
            <option value="not-submitting">Not submitting</option>
            <option value="submitting">Submitting</option>
            <option value="partial">Partial submission</option>
          </select>
        </fieldset>
      </div>
    </div>

    <!-- Section: Final Notes -->
    <div class="section">
      <h3 class="section-title">Final Notes</h3>
      <div class="input-grid">
        <div class="input-group">
          <label for="additionalNotes">Additional Notes:</label>
          <textarea id="additionalNotes" placeholder="Any extra context or observations..."></textarea>
        </div>
        <div class="checkbox-group">
          <label>Created By:</label>
          <label><input type="checkbox" name="creator" value="JW" onclick="toggleExclusive(this)"> (JW)</label>
          <label><input type="checkbox" name="creator" value="NH" onclick="toggleExclusive(this)"> (NH)</label>
          <label><input type="checkbox" name="creator" value="AA" onclick="toggleExclusive(this)"> (AA)</label>
        </div>
      </div>
    </div>

    <div class="button-container">
      <button onclick="generateReport()">Generate Report</button>
      <button class="new-report-btn" onclick="newReport()">New Report</button>
    </div>
    <div class="button-container">
      <button onclick="generateEmail()">Generate Email</button>
    </div>
    <div class="autosave-indicator" id="autosaveIndicator">Auto-save enabled ‚Äì your work is saved automatically</div>
    <div id="output"><div id="reportText"></div></div>

  </div><!-- end .content -->
</div><!-- end .container -->

<script>
  // ‚îÄ‚îÄ Stellantis radio toggle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function toggleStellantisRadio() {
    const chk = document.getElementById('chkStellantis');
    const grp = document.getElementById('stellantisRadioGroup');
    grp.style.display = chk.checked ? 'flex' : 'none';
    if (!chk.checked) {
      document.querySelectorAll('input[name="stellantisType"]').forEach(r => r.checked = false);
    }
  }

  // ‚îÄ‚îÄ Theme ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function toggleTheme() {
    const newTheme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    document.getElementById('themeIcon').textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    document.getElementById('themeText').textContent = newTheme === 'dark' ? 'Light Mode' : 'Dark Mode';
  }
  function loadTheme() {
    const t = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', t);
    if (t === 'dark') { document.getElementById('themeIcon').textContent = '‚òÄÔ∏è'; document.getElementById('themeText').textContent = 'Light Mode'; }
  }

  // ‚îÄ‚îÄ Auto-save ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  let autosaveTimeout;
  function saveFormData() {
    const fd = {};
    document.querySelectorAll('input[type="number"],input[type="text"],input[type="date"],textarea').forEach(el => { if (el.id) fd[el.id] = el.value; });
    document.querySelectorAll('input[type="checkbox"]').forEach(el => { if (el.id) fd[el.id] = el.checked; if (el.name) { if (!fd[el.name]) fd[el.name] = []; if (el.checked) fd[el.name].push(el.value); } });
    document.querySelectorAll('input[type="radio"]').forEach(el => { if (el.checked) fd['radio_' + el.name] = el.value; });
    document.querySelectorAll('select').forEach(el => { if (el.id) fd[el.id] = el.value; });
    localStorage.setItem('repairDashboardData', JSON.stringify(fd));
    const ind = document.getElementById('autosaveIndicator');
    ind.textContent = 'Auto-saved ‚úì'; ind.style.color = 'var(--success)';
    setTimeout(() => { ind.textContent = 'Auto-save enabled ‚Äì your work is saved automatically'; ind.style.color = 'var(--accent)'; }, 2000);
  }
  function loadFormData() {
    const raw = localStorage.getItem('repairDashboardData');
    if (!raw) return;
    const fd = JSON.parse(raw);
    Object.keys(fd).forEach(key => {
      const el = document.getElementById(key);
      if (!el) return;
      if (['number','text','date'].includes(el.type) || el.tagName === 'TEXTAREA') el.value = fd[key];
      else if (el.type === 'checkbox') el.checked = fd[key];
      else if (el.tagName === 'SELECT') el.value = fd[key];
    });
    document.querySelectorAll('input[type="checkbox"][name]').forEach(cb => {
      if (fd[cb.name] && Array.isArray(fd[cb.name])) cb.checked = fd[cb.name].includes(cb.value);
    });
    document.querySelectorAll('input[type="radio"]').forEach(r => {
      if (fd['radio_' + r.name] === r.value) r.checked = true;
    });
    // Restore stellantis radio visibility
    if (document.getElementById('chkStellantis').checked) {
      document.getElementById('stellantisRadioGroup').style.display = 'flex';
    }
  }
  function autoSave() { clearTimeout(autosaveTimeout); autosaveTimeout = setTimeout(saveFormData, 1000); }
  function newReport() {
    if (!confirm('Start a new report? All current data will be cleared.')) return;
    localStorage.removeItem('repairDashboardData');
    document.querySelectorAll('input[type="number"],input[type="text"],input[type="date"],textarea').forEach(el => el.value = '');
    document.querySelectorAll('input[type="checkbox"],input[type="radio"]').forEach(el => el.checked = false);
    document.querySelectorAll('select').forEach(el => el.selectedIndex = 0);
    document.getElementById('reportText').innerHTML = '';
    document.getElementById('stellantisRadioGroup').style.display = 'none';
    const ind = document.getElementById('autosaveIndicator');
    ind.textContent = 'New report started'; ind.style.color = 'var(--warning)';
    setTimeout(() => { ind.textContent = 'Auto-save enabled ‚Äì your work is saved automatically'; ind.style.color = 'var(--accent)'; }, 2000);
  }
  document.addEventListener('DOMContentLoaded', () => {
    loadTheme(); loadFormData();
    document.querySelectorAll('input,textarea,select').forEach(el => { el.addEventListener('input', autoSave); el.addEventListener('change', autoSave); });
  });

  // ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function toggleExclusive(cb) {
    document.querySelectorAll('input[name="creator"]').forEach(c => { if (c !== cb) c.checked = false; });
  }

  function flagIfLow(value, total) {
    const ratio = total > 0 ? value / total : 0;
    const txt = `(${value}/${total})`;
    return ratio < 0.65 ? `<span style="color:var(--danger);font-weight:bold;">${txt}</span>` : txt;
  }

  // Disclaimer selections ‚Äî EXCLUDES Stellantis and Volvo Warranty & Maintenance for email disclaimer paragraph
  function getDisclaimerSelections(includeAll = false) {
    const all = [
      { brand: 'BAIC',                                      id: 'baicDisclaimer' },
      { brand: 'Ford',                                      id: 'fordDisclaimer' },
      { brand: 'GWM & Haval',                               id: 'gwmhavalDisclaimer' },
      { brand: 'Honda',                                     id: 'hondaDisclaimer' },
      { brand: 'Hyundai',                                   id: 'hyundaiDisclaimer' },
      { brand: 'Isuzu',                                     id: 'isuzuDisclaimer' },
      { brand: 'JAC',                                       id: 'jacDisclaimer' },
      { brand: 'LDV',                                       id: 'ldvDisclaimer' },
      { brand: 'Mahindra',                                  id: 'mahindraDisclaimer' },
      { brand: 'MG',                                        id: 'mgDisclaimer' },
      { brand: 'Mitsubishi',                                id: 'mitsubishiDisclaimer' },
      { brand: 'Renault',                                   id: 'renaultDisclaimer' },
      { brand: 'Subaru',                                    id: 'subaruDisclaimer' },
      { brand: 'Suzuki',                                    id: 'suzukiDisclaimer' },
      { brand: 'Volvo',                                     id: 'volvoDisclaimer' },
      { brand: 'Stellantis Categorization Forms',           id: 'stellantisDisclaimer' },
      { brand: 'Volvo Warranty & Maintenance Verification', id: 'volvovDisclaimer' },
    ];
    // For email disclaimer paragraph, exclude Stellantis and Volvo W&M
    const filtered = includeAll ? all : all.filter(d => d.id !== 'stellantisDisclaimer' && d.id !== 'volvovDisclaimer');
    return filtered.map(d => ({ brand: d.brand, value: document.getElementById(d.id)?.value || '' }));
  }

  function getManagementSystemText() {
    const systems = [];
    if (document.getElementById('chkTms').checked) systems.push('TMS');
    if (document.getElementById('chkDrSmash').checked) systems.push('Dr Smash');
    if (document.getElementById('chkVantage').checked) systems.push('Vantage');
    if (document.getElementById('chkVeculim').checked) systems.push('Veculim');
    if (document.getElementById('chkEasyCost').checked) systems.push('Easy Costings');
    if (document.getElementById('chkPlanMan').checked) systems.push('Plan Manager');
    if (document.getElementById('chkAis').checked) systems.push('AIS');
    if (document.getElementById('chkMultiCat').checked) systems.push('MultiCat');
    if (document.getElementById('chkQsa').checked) systems.push('QSA');
    if (document.getElementById('chkWorkshopBoss').checked) systems.push('Workshop Boss');
    if (document.getElementById('chkAutoSoft').checked) systems.push('Auto Soft');
    const other = document.getElementById('otherMan').value.trim();
    if (other) systems.push(other);
    return systems.length ? systems.join(' or ') : 'MANAGEMENT SYSTEM';
  }

  // ‚îÄ‚îÄ Generate Report ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function generateReport() {
    const summaryParts = [];

    const today        = new Date().toLocaleDateString('en-ZA');
    const autobodyName = document.getElementById('autobodyName').value.trim();
    const activeRepairs= +document.getElementById('activeRepairs').value || 0;
    const completed2026= +document.getElementById('completed2026').value || 0;
    const completed2025= +document.getElementById('completed2025').value || 0;
    const completed2024= +document.getElementById('completed2024').value || 0;
    const completed2023= +document.getElementById('completed2023').value || 0;
    const completed2022= +document.getElementById('completed2022').value || 0;
    const writeOffs    = +document.getElementById('writeOffs').value || 0;
    const invalidJobs  = +document.getElementById('invalidJobs').value || 0;
    const pp2026       = +document.getElementById('pp2026').value || 0;
    const pp2025       = +document.getElementById('pp2025').value || 0;
    const tspRawA      = +document.getElementById('2026tsp').value || 0;
    const tspRawB      = +document.getElementById('2025tsp').value || 0;
    const openLong     = +document.getElementById('openLong').value || 0;

    const chkAggregateMake    = document.getElementById('chkAggregateMake').checked;
    const chkFullData         = document.getElementById('chkFullData').checked;
    const chkFullBrandData    = document.getElementById('chkFullBrandData').checked;
    const chkAggregateText    = document.getElementById('chkAggregateText').checked;
    const aggregateTextBrands = document.getElementById('aggregateTextBrands').value.trim();
    const chkNotReceiving     = document.getElementById('chkNotReceiving').checked;
    const receivingNotBrands  = document.getElementById('receivingNotBrands').value.trim();
    const chkInsurerName      = document.getElementById('chkInsurerName').checked;
    const aggregateMakeOption = document.querySelector('input[name="aggregateMakeOption"]:checked')?.value || '';
    const makeClause          = aggregateMakeOption ? ` ${aggregateMakeOption}` : '';

    let submissionText = '';
    const showLastSubmitted = document.getElementById('chkLastSubmitted').checked;
    const lastSubmittedDate = document.getElementById('lastSubmittedDate').value;
    if (showLastSubmitted && lastSubmittedDate) {
      submissionText = ` - Data last submitted ${new Date(lastSubmittedDate).toLocaleDateString('en-ZA')}`;
    }

    const tspAFormatted = 'R ' + tspRawA.toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    const tspBFormatted = 'R ' + tspRawB.toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

    const completedByYear = { 2022: completed2022, 2023: completed2023, 2024: completed2024, 2025: completed2025, 2026: completed2026 };
    const pastYears = [2022, 2023, 2024, 2025];
    const pastAvg   = pastYears.reduce((s, y) => s + completedByYear[y], 0) / pastYears.length;
    const expected2026 = (pastAvg / 12) * (new Date().getMonth() + 1);
    const unusuallyLowYears = [];
    pastYears.forEach(y => { if (completedByYear[y] > 0 && completedByYear[y] < pastAvg * 0.9) unusuallyLowYears.push(y); });
    if (completed2026 > 0 && completed2026 < expected2026 * 0.9) unusuallyLowYears.push(2026);

    const prefix = autobodyName ? `${autobodyName} - ` : '';
    summaryParts.push(
      `${prefix}${today}${submissionText} - Active (${activeRepairs}); Completed 2022(${completed2022}), 2023(${completed2023}), 2024(${completed2024}), 2025(${completed2025}), 2026(${completed2026}); ` +
      `Write-offs(${writeOffs}). PP 2025 ${flagIfLow(pp2025, completed2025)} & PP ${flagIfLow(pp2026, completed2026)}; ` +
      `2025 TSP(${tspBFormatted}) & 2026 TSP(${tspAFormatted}). Invalid Jobs(${invalidJobs}).`
    );

    if (openLong) summaryParts.push(`There are ${openLong}/${activeRepairs} Active repairs that have been open for more than 100 days.`);
    if (chkAggregateMake) summaryParts.push(`They are submitting aggregate data${makeClause} Make.`);
    if (chkFullBrandData) summaryParts.push(`They are submitting full data for all brands they hold approval with.`);
    if (chkFullData) summaryParts.push(`They are submitting full data for all brands.`);
    if (chkAggregateText && aggregateTextBrands) summaryParts.push(`There are some (${aggregateTextBrands}) repairs where we are receiving aggregate data.`);
    if (chkNotReceiving && receivingNotBrands) summaryParts.push(`There are some (${receivingNotBrands}) repairs where we are not receiving full data.`);
    if (chkInsurerName) summaryParts.push('They are not submitting Insurer name.');

    // Disclaimer summary ‚Äî include ALL for the report narrative
    const dData = { submitting: [], notSubmitting: [], partial: [] };
    ['baic','ford','gwmhaval','honda','hyundai','isuzu','jac','ldv','mahindra','mg','mitsubishi','renault','subaru','suzuki','volvo','stellantis','volvov'].forEach(p => {
      const v = document.getElementById(p + 'Disclaimer')?.value || '';
      let t = p === 'gwmhaval' ? 'GWM & Haval' : p === 'stellantis' ? 'Stellantis Vehicle categorization forms' : p === 'volvov' ? 'Volvo Warranty & Maintenance' : p.charAt(0).toUpperCase() + p.slice(1);
      if (v === 'submitting') dData.submitting.push(t);
      else if (v === 'not-submitting') dData.notSubmitting.push(t);
      else if (v === 'partial') dData.partial.push(t);
    });
    const SPECIAL = ['Stellantis Vehicle categorization forms', 'Volvo Warranty & Maintenance'];
const dSentences = [];

const regularSubmitting = dData.submitting.filter(b => !SPECIAL.includes(b));
const specialSubmitting = dData.submitting.filter(b => SPECIAL.includes(b));
const regularNotSubmitting = dData.notSubmitting.filter(b => !SPECIAL.includes(b));
const specialNotSubmitting = dData.notSubmitting.filter(b => SPECIAL.includes(b));
const regularPartial = dData.partial.filter(b => !SPECIAL.includes(b));
const specialPartial = dData.partial.filter(b => SPECIAL.includes(b));

if (regularSubmitting.length) dSentences.push(`They are submitting Disclaimer forms for ${regularSubmitting.join(', ').replace(/, ([^,]*)$/, ' & $1')}`);
if (regularNotSubmitting.length) dSentences.push(`They are not submitting any Disclaimer forms for ${regularNotSubmitting.join(', ').replace(/, ([^,]*)$/, ' & $1')}`);
if (regularPartial.length) dSentences.push(`They are submitting Disclaimer forms for ${regularPartial.join(', ').replace(/, ([^,]*)$/, ' & $1')}, however there appears to be repairs that do not have Disclaimer forms`);
if (specialSubmitting.length) dSentences.push(`They are submitting ${specialSubmitting.join(' & ')}`);
if (specialNotSubmitting.length) dSentences.push(`They are not submitting ${specialNotSubmitting.join(' & ')}`);
if (specialPartial.length) dSentences.push(`They are submitting ${specialPartial.join(' & ')}, however there appears to be repairs that do not have the required forms`);
if (dSentences.length) summaryParts.push(dSentences.join('. ') + '.');

    summaryParts.push('I sent them their 2025 & 2026 validation reports requesting they correct their data.');

    const ratio2025 = completed2025 > 0 ? pp2025 / completed2025 : 0;
    const ratio2026 = completed2026 > 0 ? pp2026 / completed2026 : 0;
    if (ratio2025 < 0.65 || ratio2026 < 0.65) summaryParts.push('I also noted that there are a number of repairs where we are not receiving the required parts information and requested they ensure that the required parts information is captured on their management system and submitted to AutoMX Connect.');
    if (chkNotReceiving && receivingNotBrands) summaryParts.push(`I noted we are not receiving full data for (${receivingNotBrands}) and asked them to update their permissions on their Management system so full data can be submitted for (${receivingNotBrands}).`);
    if (chkAggregateText && aggregateTextBrands) summaryParts.push(`I noted there are a number of repairs on (${aggregateTextBrands}) where we are not receiving full data and this may be due to a difference in spelling of the "MAKE" on their permissions vs the Job Card and requested they ensure full data is submitted for all repairs on (${aggregateTextBrands}).`);

    // Flagged brands for report ‚Äî includes stellantis & volvov
    const flaggedBrands = getDisclaimerSelections(true).filter(d => d.value === 'not-submitting' || d.value === 'partial').map(d => d.brand);
    if (flaggedBrands.length) summaryParts.push(`I reminded them to submit the relevant Disclaimer forms for (${flaggedBrands.join(', ')}). I referred them to & attached the relevant (${flaggedBrands.join(', ')}) bulletins & corresponding Disclaimer forms.`);

    if (openLong) summaryParts.push(`I noted there are a number of repairs which have been active for an unusually long time (${openLong}), and reminded them to close off/cancel Job cards as soon as possible after the repairs have been completed/cancelled.`);
    if (unusuallyLowYears.length) summaryParts.push(`I queried the low number of completed repairs for (${unusuallyLowYears.join(', ')}).`);
    if (writeOffs === 0) summaryParts.push('I queried lack of write-offs.');

    const additionalNotes = document.getElementById('additionalNotes').value.trim();
    const creator = document.querySelector('input[name="creator"]:checked')?.value || '';
    if (additionalNotes) summaryParts.push(creator ? `Additional Notes: ${additionalNotes} (${creator})` : `Additional Notes: ${additionalNotes}`);
    else if (creator) summaryParts.push(`(${creator})`);

    document.getElementById('reportText').innerHTML = `<p>${summaryParts.join(' ')}</p>`;
  }

  // ‚îÄ‚îÄ Generate Email ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function generateEmail() {
    const emailParts = [];
    const managementSystemText = getManagementSystemText();
    const hasCheckboxSystem = document.querySelectorAll(
      '#chkTms:checked,#chkDrSmash:checked,#chkVantage:checked,#chkVeculim:checked,#chkEasyCost:checked,#chkPlanMan:checked,#chkAis:checked,#chkMultiCat:checked,#chkQsa:checked,#chkWorkshopBoss:checked,#chkAutoSoft:checked'
    ).length > 0;

    const showLastSubmitted   = document.getElementById('chkLastSubmitted').checked;
    const lastSubmittedDate   = document.getElementById('lastSubmittedDate').value;
    const chkHasAccess        = document.getElementById('chkHasAccess').checked;
    const chkFullData         = document.getElementById('chkFullData').checked;
    const chkAggregateText    = document.getElementById('chkAggregateText').checked;
    const aggregateTextBrands = document.getElementById('aggregateTextBrands').value.trim();
    const chkAggregateMake    = document.getElementById('chkAggregateMake').checked;
    const aggregateMakeOption = document.querySelector('input[name="aggregateMakeOption"]:checked')?.value;
    const openLong            = +document.getElementById('openLong').value || 0;
    const writeOffs           = +document.getElementById('writeOffs').value || 0;
    const activeRepairsVal    = +document.getElementById('activeRepairs').value || 0;
    const completed2022       = +document.getElementById('completed2022').value || 0;
    const completed2023       = +document.getElementById('completed2023').value || 0;
    const completed2024       = +document.getElementById('completed2024').value || 0;
    const completed2025       = +document.getElementById('completed2025').value || 0;
    const completed2026       = +document.getElementById('completed2026').value || 0;
    const writeOffsVal        = +document.getElementById('writeOffs').value || 0;

    const pp2025 = +document.getElementById('pp2025').value || 0;
    const pp2026 = +document.getElementById('pp2026').value || 0;
    const ratio2025 = completed2025 > 0 ? pp2025 / completed2025 : 0;
    const ratio2026 = completed2026 > 0 ? pp2026 / completed2026 : 0;

    // Not submitting full data
    const chkNotReceiving    = document.getElementById('chkNotReceiving').checked;
    const receivingNotBrands = document.getElementById('receivingNotBrands').value.trim();

    emailParts.push('Good day,');
    emailParts.push('Kindly note, at present, your validation has failed. Kindly note this will be considered as a non-compliance at time of audit.');

    if (showLastSubmitted && lastSubmittedDate) {
      const fd = new Date(lastSubmittedDate).toLocaleDateString('en-ZA');
      let msg = `Kindly note data was last submitted to AutoMX Connect on ${fd}. Kindly note data must be submitted daily. `;
      if (hasCheckboxSystem) msg += 'Please follow the attached instructions to ensure daily submission of data. ';
      msg += `If you have any issues, we suggest you contact ${managementSystemText} directly.`;
      emailParts.push(msg + '\n');
    }

    // Not submitting full data paragraph
    if (chkNotReceiving && receivingNotBrands) {
      emailParts.push(`Kindly note we see you are not submitting full data for ${receivingNotBrands}. Please urgently update your permissions on your management system so full data can be submitted for ${receivingNotBrands}.\n`);
    }

    if (chkAggregateText && aggregateTextBrands) {
      emailParts.push(`Kindly note we see that you are not submitting full data for all repairs on ${aggregateTextBrands} vehicles. Kindly note this may be due to a difference in spelling of the Make on the relevant Job Card and your permissions on ${managementSystemText}. For example if your permissions are set to send full data for "${aggregateTextBrands}" but the make on a Job Card is captured as "EOM" your management system will read these as two different Makes and not send full data for said job card. Please ensure that full data is submitted for all repairs on ${aggregateTextBrands} vehicles from date of approval (date). Please find attached copies of your Active Repairs, 2025 Completed Repairs and 2026 Completed Reports where I have highlighted the relevant repairs in yellow.\n`);
    }

    if (chkAggregateMake && aggregateMakeOption === 'Excluding') {
      emailParts.push('Kindly note you do not need to rectify the red "No\'s" under the "Has Make" Column unless the Job Card is a repair on an approved brand.\n');
    }

    emailParts.push('Please find attached herewith updated AutoMX Connect validation reports for your company. Please correct all fields indicated in red on your management system (the changes will be sent to us on your next file upload).\n');

    if (!chkHasAccess) emailParts.push('Kindly note you can find your most up-to-date validation report by logging into AutoMX Connect (https://www.automxconnect.com/Automatrix/) and following the instructions set out in the attached Guide.\n');
    if (chkFullData) emailParts.push('Kindly note that we see that you are submitting full data for a number of OEMs which you either do not hold approval with or which are not administered by AutoMX. Kindly note that when assessing your validation report we only consider the following fields for such brands: Job Start Date, Job Completion Date (if applicable) and Part Purchase Price as this forms part of the aggregate data required to be submitted to AutoMX Connect. That being said we highly recommend that you rectify all the data flagged in the validation report, regardless of brand, as this will make the reporting available to you on AutoMX Connect much more accurate and of use to you. We wish to remind you that only you have access to the data regarding brands with which you do not hold approval or which are not administered by AutoMX.\n');
    if (chkHasAccess) emailParts.push('Please let us know the name/s, surname/s and e-mail address/es of the person/s we can grant access to AutoMX Connect. Having access to AutoMX Connect will allow you to draw the validation report (as well as other reports based on your data submissions) at your own convenience.\n');

    const selectedOEMs = [];
    if (document.getElementById('chkBaic').checked) selectedOEMs.push('BAIC');
    if (document.getElementById('chkBYD').checked) selectedOEMs.push('BYD');
    if (document.getElementById('chkChery').checked) selectedOEMs.push('Chery, Omoda & Jaecoo');
    if (document.getElementById('chkFord').checked) selectedOEMs.push('Ford');
    if (document.getElementById('chkGWMhaval').checked) selectedOEMs.push('GWM/Haval');
    if (document.getElementById('chkHonda').checked) selectedOEMs.push('Honda');
    if (document.getElementById('chkHyundai').checked) selectedOEMs.push('Hyundai');
    if (document.getElementById('chkIsuzu').checked) selectedOEMs.push('Isuzu');
    if (document.getElementById('chkJAC').checked) selectedOEMs.push('JAC');
    if (document.getElementById('chkJetour').checked) selectedOEMs.push('Jetour');
    if (document.getElementById('chkLDV').checked) selectedOEMs.push('LDV');
    if (document.getElementById('chkMahindra').checked) selectedOEMs.push('Mahindra');
    if (document.getElementById('chkMG').checked) selectedOEMs.push('MG');
    if (document.getElementById('chkMitsubishi').checked) selectedOEMs.push('Mitsubishi');
    if (document.getElementById('chkNissan').checked) selectedOEMs.push('Nissan');
    if (document.getElementById('chkRenault').checked) selectedOEMs.push('Renault');
    if (document.getElementById('chkStellantis').checked) {
  const stellantisType = document.querySelector('input[name="stellantisType"]:checked')?.value || '';
  if (stellantisType === 'Premium') selectedOEMs.push('Alfa Romeo, Abarth, Chevrolet, Chrysler, Citroen, Dodge, Fiat, Jeep, LeapMotor, Opel & Peugeot');
  else if (stellantisType === 'Standard') selectedOEMs.push('Chevrolet, Chrysler, Citroen, Dodge, Fiat, Opel & Peugeot');
  else selectedOEMs.push('Stellantis');
}
    if (document.getElementById('chkSubaru').checked) selectedOEMs.push('Subaru');
    if (document.getElementById('chkSuzuki').checked) selectedOEMs.push('Suzuki');
    if (document.getElementById('chkTata').checked) selectedOEMs.push('Tata');
    if (document.getElementById('chkVolvo').checked) selectedOEMs.push('Volvo');
    if (document.getElementById('chkBmw').checked) selectedOEMs.push('BMW');

    if (selectedOEMs.length > 0 && (ratio2025 <= 0.65 || ratio2026 <= 0.65)) {
      const tsp2025f = 'R ' + (+document.getElementById('2025tsp').value || 0).toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      const tsp2026f = 'R ' + (+document.getElementById('2026tsp').value || 0).toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      const oemList = selectedOEMs.join(', ').replace(/, ([^,]*)$/, ' and $1');

      
    emailParts.push(
  `Kindly note further that your data submissions to AutoMX Connect indicate that Parts have only been fitted to ${pp2025} vehicles repaired in 2025 & ${pp2026} vehicles repaired in 2026 and the Total Spent on Parts submitted for Body Shop has been submitted as ${tsp2025f} for 2025 and ${tsp2026f} for 2026. There also appear to be a number of repairs on approved brands where only Part Description, Part Number and Job Card Price are being submitted.`
);
emailParts.push(
  `Kindly note that the validation report checks if Part Order and Part Purchase Price are captured to let it know parts were fitted to a vehicle and so to check if Part Description, Supplier Name etc. are being submitted.`
);
emailParts.push(`Please be sure to submit the following required parts information to AutoMX Connect:`);
emailParts.push(
  `<ol style="margin:0; padding-left:20px; line-height:2;">
    <li>Part Description (for each and every part fitted to ${oemList} vehicles)</li>
    <li>Supplier Name (for each and every part fitted to ${oemList} vehicles)</li>
    <li>Part Purchase Price if purchased from the relevant OEM or one of its dealers (for each and every part fitted to ${oemList} vehicles)</li>
    <li>Total spent on Parts (not broken down by model)</li>
  </ol>`
);
    }

    // Stellantis ‚Äî only if Stellantis dropdown is partial or not-submitting
    if (document.getElementById('chkStellantis').checked) {
      const stellantisDisclaimerVal = document.getElementById('stellantisDisclaimer')?.value || '';
      if (stellantisDisclaimerVal === 'not-submitting' || stellantisDisclaimerVal === 'partial') {
        const stellantisType = document.querySelector('input[name="stellantisType"]:checked')?.value || '';
        if (stellantisType === 'Premium') {
          emailParts.push('Please also remember to complete and upload the Accident Damage Vehicle Categorization Sheet, Quality Control Documentation and supporting documents for all repairs on Stellantis vehicles and the Disclaimer form for any repairs on in-warranty Stellantis vehicles where non-genuine, second hand, alternate salvaged and/or grey parts are fitted. Please find attached the relevant bulletin regarding how to complete and upload the required documents via AutoMX (https://www.automx.co.za/automx-main/) as well as the Quality Check Sheet and Disclaimer Form.\n');
        } else if (stellantisType === 'Standard') {
          emailParts.push('Please also remember to complete and upload the Accident Damage Vehicle Categorization Sheet and supporting documents for all repairs on Stellantis vehicles and the Disclaimer form for any repairs on in-warranty Stellantis vehicles where non-genuine, second hand, alternate salvaged and/or grey parts are fitted. Please find attached the relevant bulletin regarding how to complete and upload the required documents via AutoMX (https://www.automx.co.za/automx-main/) as well as the Disclaimer Form.\n');
        } else {
          // No type selected ‚Äî generic Stellantis paragraph
          emailParts.push('Please also remember to complete and upload the Accident Damage Vehicle Categorization Sheet, Quality Control Documentation and supporting documents for all repairs on Stellantis vehicles and the Disclaimer form for any repairs on in-warranty Stellantis vehicles where non-genuine, second hand, alternate salvaged and/or grey parts are fitted. Please find attached the relevant bulletin regarding how to complete and upload the required documents via AutoMX (https://www.automx.co.za/automx-main/) as well as the Disclaimer Form.\n');
        }
      }
    }

    // Ford disclaimer paragraph
    if (selectedOEMs.includes('Ford')) {
      const fordDisclaimerVal = document.getElementById('fordDisclaimer')?.value || '';
      if (fordDisclaimerVal === 'not-submitting' || fordDisclaimerVal === 'partial') {
        emailParts.push('Please also remember to submit the relevant disclaimer form for any out of warranty Ford vehicles where non-genuine, second hand, alternate salvaged and/or grey safety critical parts are fitted. Please find attached the relevant Ford Bulletins and corresponding Disclaimer.\n');
      }
    }

    // Volvo Warranty & Maintenance ‚Äî own paragraph, only if partial or not-submitting
    const volvovDisclaimerVal = document.getElementById('volvovDisclaimer')?.value || '';
    if (volvovDisclaimerVal === 'not-submitting' || volvovDisclaimerVal === 'partial') {
      emailParts.push('Please remember to submit the Volvo Warranty & Maintenance Verification form for all repairs on Volvo Trucks.\n');
    }

    // General disclaimer paragraph ‚Äî EXCLUDES Stellantis and Volvo W&M
    const inWarrantyOEMs = getDisclaimerSelections(false).filter(d => d.value === 'not-submitting' || d.value === 'partial').map(d => d.brand);
    if (inWarrantyOEMs.length) {
      const list = inWarrantyOEMs.join(', ').replace(/, ([^,]*)$/, ' or $1');
      emailParts.push(`Please also remember to submit the relevant disclaimer form for any in warranty ${list} vehicles where non-genuine, second hand, alternate salvaged and/or grey parts are fitted. Please find attached the relevant ${list} Bulletin/s and corresponding Disclaimer form/s.\n`);
    }

    if (openLong > 0) emailParts.push('We further wish to bring to your attention that there are a number of repairs which have been active for an unusually long time. Please ensure that job cards are closed as soon as possible after completion and input relevant completion date so that AutoMX Connect can recognise that the repair has been completed. When closed, the job will automatically move from Active to completed, and count as a job for the month in which it is closed. Alternatively if the repairs have been cancelled please cancel the Job Card on your management system so AutoMX Connect knows to remove the repair from your reporting. Please find attached a copy of your Active Repairs Report which shows which repairs have been submitted to AutoMX Connect as active. Kindly note you can view the most up-to-date version of this report by logging into AutoMX Connect and following the instructions in the attached Guide.\n');

    // Low year detection
    const cby = { 2022: completed2022, 2023: completed2023, 2024: completed2024, 2025: completed2025, 2026: completed2026 };
    const py = [2022, 2023, 2024, 2025];
    const pavg = py.reduce((s, y) => s + cby[y], 0) / py.length;
    const exp2026 = (pavg / 12) * (new Date().getMonth() + 1);
    const lowYears = [];
    py.forEach(y => { if (cby[y] > 0 && cby[y] < pavg * 0.9) lowYears.push(y); });
    if (completed2026 > 0 && completed2026 < exp2026 * 0.9) lowYears.push(2026);
    if (lowYears.length) {
      const abn = document.getElementById('autobodyName').value.trim() || 'your panel shop';
      const yearsList = lowYears.join(', ').replace(/, ([^,]*)$/, ' & $1');
      const allY = [{year:2022,count:completed2022},{year:2023,count:completed2023},{year:2024,count:completed2024},{year:2025,count:completed2025},{year:2026,count:completed2026}];
      const peak = allY.reduce((m, c) => c.count > m.count ? c : m, {year:0,count:0});
      emailParts.push(`Kindly note further that the number of completed repairs for ${yearsList} appear unusually low given that ${abn} repaired ${peak.count} vehicles in ${peak.year}. Please check the below totals and let us know if they are an accurate reflection of the total number of vehicles repaired at your panel shop or not. If they are not accurate we suggest you contact ${managementSystemText} for assistance in ensuring that data for all vehicles repaired in ${yearsList} are submitted to AutoMX Connect.\n`);
    }

    const submissionStatus = showLastSubmitted ? 'NOT DAILY' : 'ACTIVE';
    const statusColor = submissionStatus === 'ACTIVE' ? '#27ae60' : '#c0392b';
    const tableHTML = `
Kindly note that below figures should match the total number of vehicles repaired at your panel shop;

<table style="border-collapse:collapse; font-family:'Calibri (Body)',Calibri (Body),sans-serif; font-size:14px; min-width:400px;">
  <tr>
    <th style="background:#6a1a7f; color:white; font-weight:bold; padding:10px 16px; text-align:left; border:1px solid #5a1a6f;">Category</th>
    <th style="background:#6a1a7f; color:white; font-weight:bold; padding:10px 16px; text-align:center; border:1px solid #5a1a6f;">Total number of vehicles</th>
  </tr>
  <tr><td style="padding:8px 16px; border:1px solid #ddd;">Active Repairs</td><td style="padding:8px 16px; border:1px solid #ddd; text-align:center;">${activeRepairsVal}</td></tr>
  <tr><td style="padding:8px 16px; border:1px solid #ddd;">2022 Completed Repairs</td><td style="padding:8px 16px; border:1px solid #ddd; text-align:center;">${completed2022}</td></tr>
  <tr><td style="padding:8px 16px; border:1px solid #ddd;">2023 Completed Repairs</td><td style="padding:8px 16px; border:1px solid #ddd; text-align:center;">${completed2023}</td></tr>
  <tr><td style="padding:8px 16px; border:1px solid #ddd;">2024 Completed Repairs</td><td style="padding:8px 16px; border:1px solid #ddd; text-align:center;">${completed2024}</td></tr>
  <tr><td style="padding:8px 16px; border:1px solid #ddd;">2025 Completed Repairs</td><td style="padding:8px 16px; border:1px solid #ddd; text-align:center;">${completed2025}</td></tr>
  <tr><td style="padding:8px 16px; border:1px solid #ddd;">2026 Completed Repairs</td><td style="padding:8px 16px; border:1px solid #ddd; text-align:center;">${completed2026}</td></tr>
  <tr><td style="padding:8px 16px; border:1px solid #ddd;">Write-offs</td><td style="padding:8px 16px; border:1px solid #ddd; text-align:center;">${writeOffsVal}</td></tr>
  <tr><td style="padding:8px 16px; border:1px solid #ddd;">Submission Status</td><td style="padding:8px 16px; border:1px solid #ddd; text-align:center; font-weight:bold; color:${statusColor};">${submissionStatus}</td></tr>
</table>
`;
    emailParts.push(tableHTML);

    if (writeOffs === 0) emailParts.push('We notice your profile does not include any write-offs. Please be reminded that in terms of the SLA with all OEMs we administer, this information must be provided.\n');
    emailParts.push('Please note that we are aware that certain information cannot be added to jobs retrospectively (such as mileage for vehicles handed back to clients). We only request that you ensure that all future jobs include all such information as to ensure compliance in future.');

    document.getElementById('reportText').innerHTML =
      emailParts
        .filter(p => p.trim() !== '')
        .map(p => {
          const isBlock = p.trimStart().startsWith('<ol') || p.trimStart().startsWith('<table') || p.trimStart().startsWith('<ul');
          return isBlock
            ? `<div style="margin-bottom:16px; line-height:1.6; color:#000000; font-family:'Calibri Body',Calibri,sans-serif; font-size:11pt;">${p}</div>`
            : `<p style="margin-bottom:16px; line-height:1.6; color:#000000; font-family:'Calibri Body',Calibri,sans-serif; font-size:11pt;">${p}</p>`;
        })
        .join('');
  }

  // ‚îÄ‚îÄ Motivation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function getMotivation() {
    const quotes = [
      "Those missing fields don't stand a chance against your determination! ‚ö°",
      "Coffee + Validation Reports = Unstoppable You! ‚òï‚ú®",
      "Those part descriptions aren't going to validate themselves - but YOU can! üíº",
      "Crying but trying is still trying. You got this boo! ü´°",
      "Work smarter, not harder‚Ä¶ unless the Wi-Fi is down, then just cry. üò´",
      "Work-life balance is just balancing coffee in one hand and panic in the other. üê∏",
      "Success is 10% inspiration, 90% pretending you understood the email. üìß",
      "Your spreadsheet doesn't define you‚Ä¶ unless it crashes, then it absolutely does. üëª",
      "Behind every great worker is a browser with 47 tabs üëÄ",
      "Success is just convincing the office plant to thrive under fluorescent lights üåπ",
      "Your inbox is infinite, but so is your willpower‚Ä¶ allegedly. üòò",
      "Success is measured in how many tabs you can keep open without crying. ü´£",
      "Success is just surviving until Friday without throwing your laptop out the window. üíª",
      "Teamwork means everyone panics together, but in sync üòõ",
      "Critical but stable, you've got this. Hopefully üò¨",
      "Every office plant is silently judging your productivity. üéç",
      "Validation errors are just spicy encouragement. üå∂Ô∏è",
      "Every missing field is just character development. üìë‚ú®",
      "Success is convincing Excel to stop gaslighting you. üß©üëÄ",
      "Every typo is just jazz improvisation. üé∑‚å®Ô∏è",
      "Every unsubmitted repair is just playing hard to get. üíÖ",
      "Your management system isn't glitching, it's just having feelings. ü§ñüíî",
      "OEMs aren't mad, they're just disappointed... but YOU'RE fixing it! üõ†Ô∏è‚ú®",
      "Part purchase prices are just numbers with commitment issues. üí∞üíç",
      "Every disclaimer form is a love letter to compliance! üíå",
      "Missing supplier names? More like surprise suppliers! üéÅ",
      "Your validation isn't failing, it's just... directionally challenged. üß≠",
      "TMS isn't ignoring you, it's just emotionally unavailable. üíîüñ•Ô∏è",
      "Stellantis categorization forms are just personality tests for cars! üöôüìã",
      "Chery Tiggo without numbers? That's just a Tiggo in witness protection! üïµÔ∏è",
      "'Think outside the box' they said. The box is the only safe space. üì¶üõ°Ô∏è",
      "'I'll look into it' = I will absolutely forget immediately. üîçü§∑",
      "'Thanks for your patience' = sorry for making you wait while I panicked. ‚è∞üò∞",
      "'At your earliest convenience' = NOW but I'm pretending to be polite. ‚ö°üò§",
      "Your database isn't corrupted, it's just having an existential crisis. üíæüåÄ",
      "CC'ing your boss is just public shaming with extra steps. üìßüé™",
      "Every 'quick question' is a 45-minute hostage situation. ‚ùì‚è∞",
      "Your coffee is cold, your dreams are dead, but this spreadsheet is THRIVING. ‚òïüíÄüìä",
      "Success is remembering your password without the 'forgot password' walk of shame. üß†üîë",
      "'Gentle reminder' = This is reminder #47, I'm no longer gentle. üîîüò§",
      "Success is holding in your feral scream until you reach your car. üöóüò§",
      "'Constructive feedback' = Your soul is about to leave your body. üí¨‚ö∞Ô∏è",
      "'End of day' = 11:59pm because time is a social construct. üïõüåô",
      "Success is not googling 'how to fake your own death' at work. üîçüíÄ",
      "Every 'friendly reminder' is the opposite of friendly. üîîüò†",
      "Friday energy on Monday should be illegal. üìÖ‚öñÔ∏è",
      "Success is when your passive-aggressive email gets the response you wanted. üìßüòè",
      "Your inbox is sentient and it hates you specifically. üì®üßø",
    ];
    document.getElementById('motivationText').textContent = quotes[Math.floor(Math.random() * quotes.length)];
    document.getElementById('motivationBox').style.display = 'block';
    document.getElementById('motivationBox').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  }
</script>
</body>
</html>







